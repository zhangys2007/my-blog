(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{761:function(e,o,n){"use strict";n.r(o);var t=n(5),a=Object(t.a)({},(function(){var e=this,o=e.$createElement,n=e._self._c||o;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"åŸºæœ¬æ¦‚å¿µ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åŸºæœ¬æ¦‚å¿µ"}},[e._v("#")]),e._v(" åŸºæœ¬æ¦‚å¿µ")]),e._v(" "),n("p",[e._v("å°± iOS å¼€å‘è€Œè¨€ï¼Œå…³äº copy çš„å‡ ä¸ªæ¦‚å¿µï¼š")]),e._v(" "),n("ol",[n("li",[e._v("æ‹·è´ï¼šå³å¤åˆ¶ï¼Œç›®çš„æ˜¯äº§ç”Ÿå‰¯æœ¬ï¼Œè®©åŸå¯¹è±¡å’Œå‰¯æœ¬ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼›")]),e._v(" "),n("li",[e._v("ä¸å¯å˜æ‹·è´ï¼šå³ copy æ–¹æ³•ï¼Œæ— è®ºåŸå¯¹è±¡æ˜¯å¦å¯å˜ï¼Œéƒ½äº§ç”Ÿä¸å¯å˜å‰¯æœ¬ï¼›")]),e._v(" "),n("li",[e._v("å¯å˜æ‹·è´ï¼šå³ mutableCopy æ–¹æ³•ï¼Œæ— è®ºåŸå¯¹è±¡æ˜¯å¦å¯å˜ï¼Œéƒ½äº§ç”Ÿå¯å˜å‰¯æœ¬ï¼›")]),e._v(" "),n("li",[e._v("æ·±æ‹·è´ï¼šå†…å®¹æ‹·è´ï¼Œäº§ç”Ÿæ–°çš„å¯¹è±¡ï¼›")]),e._v(" "),n("li",[e._v("æµ…æ‹·è´ï¼šæŒ‡é’ˆæ‹·è´ï¼Œä¸äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼›")])]),e._v(" "),n("p",[e._v("ç”±ä¸Šå¯çŸ¥ï¼Œcopy å’Œæ·±æ‹·è´æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸¤è€…å¹¶ä¸ä¸€å®šç›¸ç­‰ï¼Œå…ˆç»™ç»“æœï¼š")]),e._v(" "),n("ul",[n("li",[e._v("æºå¯¹è±¡ä¸å¯å˜æ—¶ï¼Œcopy æ–¹æ³•å°±æ˜¯æµ…æ‹·è´ï¼›")]),e._v(" "),n("li",[e._v("æºå¯¹è±¡å¯å˜æ—¶ï¼Œcopy æ–¹æ³•å°±æ˜¯æ·±æ‹·è´ï¼›")]),e._v(" "),n("li",[e._v("mutableCopy æ–¹æ³•æ— è®ºä½•ç§æƒ…å†µéƒ½æ˜¯æ·±æ‹·è´ï¼›")])]),e._v(" "),n("h1",{attrs:{id:"copy-ä¿®é¥°å±æ€§"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy-ä¿®é¥°å±æ€§"}},[e._v("#")]),e._v(" copy ä¿®é¥°å±æ€§")]),e._v(" "),n("p",[e._v("ä¸Šæ–‡ä¸­çŸ¥é“äº†ï¼Œæ‹·è´åˆ†æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œé‚£ä¹ˆ@propertyä¸­çš„copyå…³é”®å­—æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿæœ‰æ²¡æœ‰ mutablecopy å…³é”®å­—å‘¢ï¼Ÿ\nå…ˆè¯´ç»“è®ºï¼š")]),e._v(" "),n("ul",[n("li",[e._v("å±æ€§ä¸­ copy å…³é”®å­—çš„ä½œç”¨å°±æ˜¯è°ƒç”¨è¢«èµ‹å€¼ç»™å±æ€§çš„å¯¹è±¡çš„copyWithZoneæ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼èµ‹å€¼ç»™å±æ€§;")])]),e._v(" "),n("p",[e._v("å†æ¥çœ‹æºç , é¦–å…ˆçœ‹ä¸€æ®µæˆ‘ä»¬å¸¸ç”¨çš„å±æ€§å£°æ˜ä»£ç ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("@interface XKPerson()\n@property (copy, nonatomic) NSString *name;\n@property (assign, nonatomic) NSInteger age;\n\n@end\n\n@implementation XKPerson\n\n@end\n")])])]),n("p",[e._v("ä½¿ç”¨ç¼–è¯‘æŒ‡ä»¤ç”Ÿæˆ cpp æ–‡ä»¶ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("xcrun  -sdk  iphoneos  clang  -arch  arm64  -rewrite-objc XKPerson.m -o XKPerson.cpp\n")])])]),n("p",[e._v("ç„¶åæˆ‘ä»¬æ¥æ‰¾æ‰¾propertyæœ€åç”Ÿæˆçš„ä»£ç æ˜¯æ€æ ·çš„ï¼Œcpp æ–‡ä»¶ä¸­å…³äºå±æ€§çš„å®ç°ä»£ç å¦‚å›¾æ‰€ç¤ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('// @interface XKPerson()\n// @property (copy, nonatomic) NSString *name;\n// @property (assign, nonatomic) NSInteger age;\n/* @end */\n\n// @implementation XKPerson\n\nstatic NSString * _I_XKPerson_name(XKPerson * self, SEL _cmd) { return (*(NSString **)((char *)self + OBJC_IVAR_$_XKPerson$_name)); }\nextern "C" __declspec(dllimport) void objc_setProperty (id, SEL, long, id, bool, bool);\n\nstatic void _I_XKPerson_setName_(XKPerson * self, SEL _cmd, NSString *name) { objc_setProperty (self, _cmd, __OFFSETOFIVAR__(struct XKPerson, _name), (id)name, 0, 1); }\n\nstatic NSInteger _I_XKPerson_age(XKPerson * self, SEL _cmd) { return (*(NSInteger *)((char *)self + OBJC_IVAR_$_XKPerson$_age)); }\nstatic void _I_XKPerson_setAge_(XKPerson * self, SEL _cmd, NSInteger age) { (*(NSInteger *)((char *)self + OBJC_IVAR_$_XKPerson$_age)) = age; }\n// @end\n')])])]),n("p",[e._v("ä¹Ÿå°±æ˜¯è¯´ï¼Œ@propertyåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå¸®æˆ‘ç”Ÿæˆ setterå’Œ getteræ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å£°æ˜å¹¶å®ç°äº†å››ä¸ªæ–¹æ³•ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    static NSString * _I_XKPerson_name\n    static void I_XKPerson_setName\n    static NSInteger _I_XKPerson_age\n    static void I_XKPerson_setAge\n")])])]),n("p",[e._v("è¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¢ç©¶å±æ€§ä¸­çš„ copyï¼Œè€Œä¸” copy åªåœ¨è®¾ç½®å±æ€§çš„æ—¶å€™èµ·ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…³æ³¨ "),n("em",[e._v("I_XKPerson_setName")]),e._v(" è¿™ä¸ªæ–¹æ³•å³å¯ï¼Œå…¶æ ¸å¿ƒæ˜¯è°ƒç”¨äº†objc_setProperty()è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥åˆ° objc4 çš„æºç ï¼Œä¸‹è½½ æºç åçœ‹çœ‹objc_setPropertyè¿™ä¸ªå‡½æ•°åšäº†å•¥ï¼Œä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    #define MUTABLE_COPY 2\n    void objc_setProperty(id self, SEL _cmd, ptrdiff_t offset, id newValue, BOOL atomic, signed char shouldCopy) \n    {\n        bool copy = (shouldCopy && shouldCopy != MUTABLE_COPY);\n        bool mutableCopy = (shouldCopy == MUTABLE_COPY);\n        // copy å’Œ mutableCopyæœ€å¤šåªæœ‰ä¸€ä¸ªä¸ºçœŸ(1)\n        reallySetProperty(self, _cmd, newValue, offset, atomic, copy, mutableCopy);\n    }\n")])])]),n("p",[e._v("å…¶ä½™ä»£ç å°±ä¸è´´äº†ï¼ŒMUTABLE_COPYå€¼ä¸º2ï¼Œè€Œsetterä¸­ä¼ çš„å€¼ä¸º1ï¼Œæœ€ç»ˆä¼šè¿›å…¥åˆ°reallySetPropertyè¿™ä¸ªæ–¹æ³•ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy){\n    if (offset == 0) {\n        // ä¿®æ”¹ isa æŒ‡å‘\n        object_setClass(self, newValue);\n        return;\n    }\n    id oldValue;\n    id *slot = (id*) ((char*)self + offset);\n    // copyçš„é€»è¾‘\n    if (copy) {\n        // å±æ€§ä¿®é¥°å…³é”®å­—åªæœ‰ copy\n        newValue = [newValue copyWithZone:nil];\n    } else if (mutableCopy) {\n        // å±æ€§ä¿®é¥°å…³é”®å­—åªæœ‰ copy , è¿™é‡Œæ˜¯å®ç°äº† mutableCopying åè®®æ—¶çš„å¤„ç†é€»è¾‘\n        newValue = [newValue mutableCopyWithZone:nil];\n    } else {\n        if (*slot == newValue) return;\n        newValue = objc_retain(newValue);\n    }\n    if (!atomic) {\n        oldValue = *slot;\n        *slot = newValue;\n    } else {\n        spinlock_t& slotlock = PropertyLocks[slot];\n        slotlock.lock();\n        oldValue = *slot;\n        *slot = newValue;        \n        slotlock.unlock();\n    }\n    // é‡Šæ”¾åŸå¯¹è±¡\n    objc_release(oldValue);\n    }\n")])])]),n("p",[e._v("å…¶å®è¿™æ®µä»£ç è¿˜æ˜¯æŒºç»å…¸çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åªçœ‹ copy çš„éƒ¨åˆ†ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    // copyçš„é€»è¾‘\n    if (copy) {\n        // å±æ€§ä¿®é¥°å…³é”®å­—åªæœ‰ copy ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šè¿›å…¥åˆ°è¿™é‡Œ\n        newValue = [newValue copyWithZone:nil];\n    } else if (mutableCopy) {\n        // å±æ€§ä¿®é¥°å…³é”®å­—åªæœ‰ copy , è¿™é‡Œæ˜¯å®ç°äº† mutableCopying åè®®æ—¶çš„å¤„ç†é€»è¾‘\n        newValue = [newValue mutableCopyWithZone:nil];\n    } else {\n        if (*slot == newValue) return;\n\n        // NSStringç­‰ä¸å¯å˜å¯¹è±¡è°ƒç”¨copyï¼Œå…¶å†…éƒ¨çš„ä»£ç é€»è¾‘ä¼šèµ°åˆ°è¿™é‡Œæ¥\n        // æ­¤æ—¶ copy ä¸äº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œå±äºæµ…æ‹·è´ï¼Œæ‰€ä»¥ copy å’Œ retain çš„ä»£ç é€»è¾‘ç­‰ä»·(ä½†æ˜¯å¯ä¸èƒ½å°† copy å…³é”®å­—æ›¿æ¢æˆ retain å“¦ğŸ˜¯~)\n        newValue = objc_retain(newValue);\n    }\n")])])]),n("p",[e._v("ä»æºç ä¸­å°±ä¸€ç›®äº†ç„¶äº†ï¼š")]),e._v(" "),n("ol",[n("li",[e._v("å¦‚æœæ˜¯ copy æ–¹æ³•ï¼Œåˆ™è°ƒç”¨å¯¹è±¡çš„ copyWithZoneæ–¹æ³•ï¼›")]),e._v(" "),n("li",[e._v("å¦‚æœæ˜¯mutablecopyï¼Œåˆ™è°ƒç”¨å¯¹è±¡çš„mutableCopyWithZone æ–¹æ³•ï¼›")]),e._v(" "),n("li",[e._v("å¦‚æœ copy = 0ï¼Œmutablecopy = 0ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šè°ƒç”¨objc_retainæ–¹æ³•ï¼›")])]),e._v(" "),n("p",[e._v("å…¶ä¸­ï¼Œä½¿ç”¨retainä¿®é¥°å±æ€§æ—¶ï¼Œå°±æ˜¯ç¬¬ä¸‰ç§æƒ…å†µï¼Œä»£ç ä¸­ä¹Ÿå¯ä»¥å¾—åˆ°éªŒè¯ï¼Œä¿®æ”¹copyä¸º retainåç¼–è¯‘çš„ç»“æœï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    // æœ€åä¸€ä¸ªå‚æ•°ç”± 1 å˜æˆäº† 0\n    static void _I_XKPerson_setName_(XKPerson * self, SEL _cmd, NSString *name) {   \n        objc_setProperty (self, _cmd, __OFFSETOFIVAR__(struct XKPerson, _name), (id)name, 0, 0); \n    }\n")])])]),n("p",[e._v("å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ strong å’Œ assignä¿®é¥°ï¼Œæœ€ç»ˆ setter ä¸è°ƒç”¨ objc_setPropertyæ–¹æ³•è€Œæ˜¯é€šè¿‡åç§»é‡è¿›è¡ŒæŒ‡é’ˆèµ‹å€¼æˆ–è€…ç›´æ¥èµ‹å€¼ï¼Œå…·ä½“å°±ä¸å†è¿™é‡Œæ¢è®¨äº†~~")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("è¿™é‡Œç•™ä¸ªç–‘é—®ï¼š")]),e._v(" "),n("p",[e._v("å¦‚æœç”¨ copy ä¿®é¥°ï¼Œé‚£ä¹ˆå±æ€§æœ€ç»ˆè½¬åŒ–æˆçš„ setter ä¸­æ‰§è¡Œçš„ objc_setProperty æ–¹æ³•çš„ä¼ å€¼ä¸­ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ°¸è¿œä¸º1ã€‚è€Œobjc_setPropertyå†…éƒ¨è°ƒç”¨çš„ä¹Ÿæ˜¯reallySetPropertyæ–¹æ³•ã€‚ä¸º1æ—¶ï¼Œè°ƒç”¨reallySetPropertyæ–¹æ³•ä¸­çš„å‚æ•°æ°¸è¿œæ˜¯bool copy = 1, bool mutablecopy = 0ï¼Œä¹Ÿå°±æ˜¯ä¼šèµ°åˆ°copyWithZoneè¿™å±‚é€»è¾‘ã€‚è€Œä½¿ç”¨ retainä¿®é¥°å±æ€§ï¼Œå‚æ•°bool copy = 0, bool mutablecopy = 0ï¼Œä¼šèµ°åˆ°obje_retainè¿™å±‚é€»è¾‘ï¼Œå½’çº³å¦‚ä¸‹ï¼š")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("å…³é”®å­—")]),e._v(" "),n("th",[e._v("å‚æ•°copyçš„å€¼")]),e._v(" "),n("th",[e._v("å‚æ•°mutablecopyçš„å€¼")]),e._v(" "),n("th",[e._v("ä»£ç é€»è¾‘")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("retain")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("obje_retain()")])]),e._v(" "),n("tr",[n("td",[e._v("copy")]),e._v(" "),n("td",[e._v("1")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("copyWithZone()")])])])]),e._v(" "),n("p",[e._v("åªæœ‰objc_setPropertyæœ€åä¸€ä¸ªå‚æ•°ä¸º 2 æ—¶ï¼Œæ‰ä¼šèµ°åˆ° mutableCopy çš„é€»è¾‘ï¼Œæ‰€ä»¥reallySetPropertyæ–¹æ³•ä¸­çš„mutablecopyWithZoneçš„ä»£ç ä½•æ—¶ä¼šè¢«è°ƒç”¨å‘¢ï¼Ÿï¼Ÿï¼Ÿ")]),e._v(" "),n("h1",{attrs:{id:"ä½¿ç”¨-copy-ä¿®é¥°å­—ç¬¦ä¸²æ„ä¹‰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨-copy-ä¿®é¥°å­—ç¬¦ä¸²æ„ä¹‰"}},[e._v("#")]),e._v(" ä½¿ç”¨ copy ä¿®é¥°å­—ç¬¦ä¸²æ„ä¹‰")]),e._v(" "),n("p",[e._v("å…ˆè¯´ç»“è®ºï¼Œä½¿ç”¨ copy ä¿®é¥°å±æ€§çš„æ„ä¹‰åœ¨äºï¼š")]),e._v(" "),n("p",[e._v("æ˜ç¡®å‘Šè¯‰ä½¿ç”¨è€…ï¼Œè®¾è®¡è€…ä¸å¸Œæœ›ä¸”ä¸èƒ½ç›´æ¥ä¿®æ”¹å±æ€§å¯¹è±¡æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼ï¼›")]),e._v(" "),n("p",[e._v("ä¸å¸Œæœ›ä½“ç°åœ¨ä½¿ç”¨ä½¿ç”¨ NSString ç±»å‹æ¥å£°æ˜å±æ€§ï¼Œè¿™æ ·å¦‚æœä½¿ç”¨ appendString:çš„æ–¹æ³•ï¼Œå°±æŠ¥æŠ¥ç¼–è¯‘é”™è¯¯ã€‚\nä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ strong æ¥ä¿®é¥°å­—ç¬¦ä¸²å±æ€§ï¼ŒåŠ ä¸Šå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä»ç„¶å¯ä»¥å®ç°ç›´æ¥ä¿®æ”¹å†…å­˜åœ°å€ä¸­çš„å€¼ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    // personå¯¹è±¡ä¸­ä½¿ç”¨ strong ä¿®é¥° å±æ€§\n    @property (strong, nonatomic) NSString *name1;\n    XKPerson *p = [XKPerson new];   \n    NSMutableString *name = [[NSMutableString alloc] initWithFormat:@"%@",@"Jack"];\n    // æ­¤æ—¶å¦‚æœæ˜¯ç”¨ strong ä¿®é¥° nameï¼Œè™½ç„¶å£°æ˜çš„æ˜¯ NSString å¯¹è±¡ï¼Œä½†å®é™…ç±»å‹æ˜¯ NSMutableString ç±»å‹\n    p.name = name;\n    [(NSMutableString *)p.name appendFormat:@"1"];\n')])])]),n("p",[e._v("ä»¥ä¸Šä»£ç å°±å®ç°äº†ç›´æ¥ä¿®æ”¹å±æ€§æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¸­çš„å€¼ï¼Œæ­¤æ—¶ä¿®æ”¹æˆä½¿ç”¨ copy ä¿®é¥°ï¼Œå› ä¸ºè°ƒç”¨çš„copyWithZoneï¼Œç»“æœè¿”å›çš„å¿…å®šæ˜¯ä¸å¯å˜ç±»å‹ï¼Œæ‰€ä»¥å³ä½¿èµ‹å€¼æ—¶æ˜¯NSMutableStringç±»å‹ï¼Œæœ€ç»ˆå¾—åˆ°çš„ä»ç„¶æ˜¯NSStringç±»å‹ï¼Œè¿™æ ·å°±èµ·åˆ°äº†é¢„æœŸçš„æ•ˆæœï¼›\næ‰€ä»¥ï¼ŒNSString ç±»å‹ä½¿ç”¨ copy ä¿®é¥°æ˜¯æœ€å¥½ä¸è¿‡çš„~~~")]),e._v(" "),n("p",[e._v("è¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªåœºæ™¯ï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å‘ä¸­ï¼Œå¸Œæœ›å­—ç¬¦ä¸²å±æ€§è·ŸéšæŸä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å€¼åŒæ—¶æ”¹å˜ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨ strong + NSMutableStringäº†ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    @property (strong, nonatomic) NSMutableString *name;\n    // ä½¿ç”¨\n    XKPerson *p = [XKPerson new];\n    NSMutableString *name = [NSMutableString stringWithFormat:@"ç‹"];\n    p.name = name;\n    NSLog(@"%@",p.name);\n    [name appendString:@"å°äºŒ"];\n    NSLog(@"%@",p.name);\n')])])]),n("p",[e._v("ç»“æœï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    2019-12-27 17:53:51.730 XKStringTest[10172:63201310] ç‹\n    2019-12-27 17:53:51.731 XKStringTest[10172:63201310] ç‹å°äºŒ\n")])])]),n("p",[e._v('è¿™ä¸ªæ—¶å€™å¦‚æœä½¿ç”¨ copy ä¿®é¥°ï¼Œå†ä½¿ç”¨[self.name appendStringï¼š@"xxx"] åè€Œä¼šå´©æºƒï¼Œå’Œä½¿ç”¨ copy ä¿®é¥° NSMutableArray æ—¶åŒç†ã€‚\nå†é‡ç”³ä¸€éï¼šcopy æ˜¯ä¸ºäº†è·å¾—ä¸å¯å˜å‰¯æœ¬ï¼ŒmutableCopy æ˜¯ä¸ºäº†è·å–å¯å˜å‰¯æœ¬ï¼Œè€Œä¿®é¥°å±æ€§çš„å…³é”®å­—åªæœ‰ copyã€‚\nè¿™ä¸ªåœºæ™¯ä¸­ä½¿ç”¨å…¶å®åº”è¯¥ä½¿ç”¨ mutableCopy ä¿®é¥°ï¼Œåˆ›å»ºçš„å°±æ˜¯å¯å˜çš„ç‹¬ç«‹å­—ç¬¦ä¸²å‰¯æœ¬äº†ï¼Œä½†æ˜¯ æ²¡æœ‰ mutableCopy å…³é”®å­—ä¿®é¥°å±æ€§ã€‚\næ‰€ä»¥ï¼Œåˆ‡è®°å“¦ğŸ˜¯ï¼š')]),e._v(" "),n("p",[e._v("åœ¨å±æ€§ä¸­ä¸è¦ä½¿ç”¨ copy ä¿®é¥°NSMutableArrayã€NSMutableDictionaryç­‰å¯å˜ç±»å‹ï¼›")]),e._v(" "),n("h1",{attrs:{id:"copy-åè®®"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy-åè®®"}},[e._v("#")]),e._v(" copy åè®®")]),e._v(" "),n("p",[e._v("ä¸Šä¸€ç« èŠ‚è®²åˆ°äº†å±æ€§ä¿®é¥°ä¸­ copy å…³é”®å­—çš„æœ¬è´¨æ˜¯è°ƒç”¨copyWithZoneæ–¹æ³•ã€‚ä¹‹æ‰€ä»¥èƒ½å¤Ÿä½¿ç”¨ copy ä¿®é¥°å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰ï¼Œæ˜¯å› ä¸ºè¿™äº›ç³»ç»Ÿå¯¹è±¡å®ç°äº† copy ç›¸å…³çš„åè®®ã€‚\næ‰€ä»¥ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼šè‡ªå®šä¹‰copyWithZoneæ–¹æ³•ã€‚å¹³å¸¸æˆ‘ä»¬ä½¿ç”¨ copy ä¿®é¥°çš„æœ€å¤šçš„å°±æ˜¯å­—ç¬¦ä¸²\nå› æ­¤ï¼ŒOC ä¸­ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªåè®®ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    @protocol NSCopying\n    - (id)copyWithZone:(nullable NSZone *)zone;\n    @end\n\n    @protocol NSMutableCopying\n    - (id)mutableCopyWithZone:(nullable NSZone *)zone;\n    @end\n")])])]),n("p",[e._v("å…·ä½“å®ç°å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    - (id)copyWithZone:(NSZone *)zone {\n        XKPerson *newP = [[XKPerson allocWithZone:zone] init];\n        newP.name = self.name;\n        newP.age = self.age;\n        return newP;\n    }\n\n    - (id)mutableCopyWithZone:(NSZone *)zone {\n        XKPerson *newP = [[XKPerson allocWithZone:zone] init];\n        newP.name = self.name;\n        newP.age = 10;\n        return newP;\n    }\n")])])]),n("p",[e._v("ä½¿ç”¨ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    XKPerson *p = [XKPerson new];\n    p.name = @"Jack";\n    p.age = 18;\n    XKPerson *p1 = [p copy];\n    XKPerson *p2 = [p mutableCopy];\n    NSLog(@"%p %p %p", p, p1, p2);\n    p1.name = @"Lucy";\n    NSLog(@"%@",p1.name);\n')])])]),n("p",[e._v("ç»“æœï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    2019-12-27 17:42:11.326 XKStringTest[9991:63192515] 0x7ae30b10 0x7ae31340 0x7ae313e0\n    2019-12-27 17:42:11.327 XKStringTest[9991:63192515] Lucy\n")])])]),n("p",[e._v("copy åœ¨æ•°æ®æ¨¡å‹ model ä¸­æ—¶å¯èƒ½ä¼šè¾ƒå¤šä½¿ç”¨ copyï¼Œæ­¤æ—¶å®ç°copyåè®®å³å¯ï¼Œä½†åœ¨å¹³æ—¶è‡ªå®šä¹‰å¯¹è±¡ä½¿ç”¨ copy å¹¶ä¸å¤šï¼Œè¿™ä¸¤ä¸ªåè®®å°±ä¸å¤šè¯´äº†~~")]),e._v(" "),n("h1",{attrs:{id:"block-ä¸ºä»€ä¹ˆä½¿ç”¨-copy-ä¿®é¥°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#block-ä¸ºä»€ä¹ˆä½¿ç”¨-copy-ä¿®é¥°"}},[e._v("#")]),e._v(" Block ä¸ºä»€ä¹ˆä½¿ç”¨ copy ä¿®é¥°")]),e._v(" "),n("p",[e._v("ä¼šåœ¨ blockè¿›é˜¶ä¸­è®²åˆ°ï¼Œä½†æ˜¯è¿™é‡Œä¹ŸæŠŠæ ¸å¿ƒè¯´ä¸€ä¸‹ï¼Œæ¥çœ‹ä¸€æ®µä»£ç å°±èƒ½çœ‹åˆ°æœ¬è´¨ï¼Œé ARC æ¨¡å¼ä¸‹ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('    int main(int argc, const char * argv[]) {\n        @autoreleasepool {\n        // çœ‹çœ‹ block ä¸­ copy æ–¹æ³•çš„æœ¬è´¨\n        int age = 10;\n        void(^block)(void) = ^(void){\n            NSLog(@"%d",age);\n         };\n    \n        NSLog(@"%p",block);\n        NSLog(@"%@",[block class]);\n        block = [block copy];\n        NSLog(@"%p",block);\n        NSLog(@"%@",[block class]);\n\n        }\n        return 0;\n    }\n')])])]),n("p",[e._v("æ‰“å°ç»“æœï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    2020-01-03 09:02:36.888792+0800 XKBlockTest[84409:72373799] 0x7ffeefbff488\n    2020-01-03 09:02:36.889375+0800 XKBlockTest[84409:72373799] __NSStackBlock__\n    2020-01-03 09:02:36.889904+0800 XKBlockTest[84409:72373799] 0x1006444b0\n    2020-01-03 09:02:36.889961+0800 XKBlockTest[84409:72373799] __NSMallocBlock__\n")])])]),n("p",[e._v("åˆ†æï¼š")]),e._v(" "),n("ol",[n("li",[e._v("ä»£ç ä¸­åªæ˜¯ä¸ºäº†æµ‹è¯•ï¼Œæ‰€ä»¥çœå»äº† release ç­‰æ“ä½œï¼›")]),e._v(" "),n("li",[e._v("copy çš„æœ¬è´¨å’Œå­—ç¬¦ä¸²ç­‰çš„å®ç°å¤§åŒå°å¼‚ï¼Œéƒ½æ˜¯è¿”å›ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼›")]),e._v(" "),n("li",[e._v("å› ä¸ºè®¿é—®äº† auto å˜é‡çš„ Block ä½œä¸º__NSStackBlock__å­˜æ”¾åœ¨æ ˆä¸­ï¼Œå¦åˆ™ä½œä¸º__NSGlobalBlock__å­˜æ”¾åœ¨æ•°æ®åŒº(å…¨å±€åŒº)ï¼Œæ ˆä¸­çš„ Block éšæ—¶ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥ç³»ç»Ÿå®ç°çš„ copy æ“ä½œåœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„ Block å¹¶è¿”å›ï¼Œè¿™å°±æ˜¯ä¸¤æ¬¡æ‰“å°å†…å­˜ç»“æœä¸ä¸€æ ·çš„åŸå› ï¼›")]),e._v(" "),n("li",[e._v("Block å­˜æ”¾åœ¨å †ä¸­æ—¶è¢«æ ‡è®°æˆ__NSMallocBlock__ç±»å‹ï¼Œé ARC ä¸­éœ€è¦æ‰‹åŠ¨ releaseï¼›")]),e._v(" "),n("li",[e._v("Block ä½¿ç”¨ copy ä¿®é¥°æ—¶ï¼ŒåŒå­—ç¬¦ä¸²ç­‰ä¸€æ ·ï¼Œä¼šè°ƒç”¨æ–°å€¼çš„ copy æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ Block çš„ copy æ–¹æ³•ï¼›")]),e._v(" "),n("li",[e._v("Block å±æ€§ä½¿ç”¨weakä¿®é¥°ä¸ç”¨å¤šè¯´ï¼Œæ—¢ä¸è°ƒç”¨ copy æ–¹æ³•ï¼Œä¹Ÿä¸å¢åŠ å¼•ç”¨è®¡æ•°å™¨ï¼›")])]),e._v(" "),n("p",[e._v("ç›´æ¥è¯´æ€»ç»“å§ï¼š\nå› ä¸º ARC ä¼šåœ¨å‡ ç§ç‰¹å®šæƒ…å†µä¸‹ä¸»åŠ¨è°ƒç”¨ Block çš„ copy æ–¹æ³•ï¼Œæ¯”å¦‚è¢« strong ä¿®é¥°æ—¶ï¼ŒGCDä¸­çš„Blockã€ç³»ç»Ÿçš„ UsingBlock æ–¹æ³•ç­‰ï¼Œæ‰€ä»¥ï¼š")]),e._v(" "),n("ul",[n("li",[e._v("ARC ä¸­çš„ Block å±æ€§ä½¿ç”¨ copy å’Œ strong ä¿®é¥° Block éƒ½å¯ä»¥")])]),e._v(" "),n("ol",[n("li",[e._v("ä½¿ç”¨ copy ä¿®é¥°æ—¶ï¼Œç›¸å½“äºä¸»åŠ¨è°ƒç”¨ copy æ–¹æ³•ï¼ŒStackBlock ä¼šè¢«æ‹·è´åˆ°å †ä¸Šè€Œæˆä¸º MallocBlockï¼›")]),e._v(" "),n("li",[e._v("ä½¿ç”¨ strong ä¿®é¥°æ—¶ï¼ŒARC æ¨¡å¼ä¸‹ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ copy æ–¹æ³•ï¼ŒStackBlock ä¼šè¢«æ‹·è´åˆ°å †ä¸Šè€Œæˆä¸º MallocBlockï¼›")])]),e._v(" "),n("ul",[n("li",[e._v("MRC ä¸­çš„ Block å±æ€§å¿…é¡»ä½¿ç”¨ copy ä¿®é¥°")])]),e._v(" "),n("ol",[n("li",[e._v("ä½¿ç”¨ copy ä¿®é¥°æ—¶ï¼Œç›¸å½“äºä¸»åŠ¨è°ƒç”¨ copy æ–¹æ³•ï¼ŒStackBlock ä¼šè¢«æ‹·è´åˆ°å †ä¸Šè€Œæˆä¸º MallocBlockï¼›")]),e._v(" "),n("li",[e._v("MRC æ¨¡å¼ä¸‹ï¼Œstrong ä¿®é¥° Block åªä¼š retainï¼Œä¸ä¼šè‡ªåŠ¨è°ƒç”¨ Block çš„ copy æ–¹æ³•ï¼›")])]),e._v(" "),n("h1",{attrs:{id:"æ€»ç»“"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[e._v("#")]),e._v(" æ€»ç»“")]),e._v(" "),n("p",[e._v("ä»¥ä¸Šï¼Œæ€»ç»“ä¸‹ copy çš„å‡ ä¸ªé‡ç‚¹ï¼Œæ–¹ä¾¿è®°å¿†ï¼š")]),e._v(" "),n("ol",[n("li",[e._v("copy çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªäº’ä¸å¹²æ‰°ï¼Œç›¸äº’ç‹¬ç«‹çš„å‰¯æœ¬ï¼›")]),e._v(" "),n("li",[e._v("copy æ— è®ºæ˜¯ç›´æ¥è°ƒç”¨è¿˜æ˜¯ä¿®é¥°å±æ€§ï¼Œå…¶æœ¬è´¨æ˜¯è°ƒç”¨copyWithZoneå’ŒmutableCopyWithZoneæ–¹æ³•ï¼›")]),e._v(" "),n("li",[e._v("æ·±æµ…å¤åˆ¶çš„åŒºåˆ«åœ¨äºè¿”å›å€¼æ˜¯å¦ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå’Œè°ƒç”¨ copy çš„å“ªä¸ªæ–¹æ³•æ— å…³ï¼›")]),e._v(" "),n("li",[e._v("ä½¿ç”¨ copy ä¿®é¥°å±æ€§çš„å…³é”®ç›®çš„æ˜¯å‘Šè¯‰ä½¿ç”¨è€…ï¼Œè¿™ä¸ªä¸è¦ç›´æ¥ä¿®æ”¹å±æ€§æ‰€æŒ‡å‘å†…å­˜ä¸­çš„å€¼ï¼›")]),e._v(" "),n("li",[e._v("ä¿®é¥°å¯å˜ç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¯å˜æ•°ç»„ï¼Œä¸¥ç¦ä½¿ç”¨ copy ä¿®é¥°ï¼›")]),e._v(" "),n("li",[e._v("copy çš„æœ¬è´¨æ˜¯è°ƒç”¨ copy åè®®ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåªæ˜¯ç³»ç»Ÿå¯¹å­—ç¬¦ä¸²ã€æ•°ç»„ã€å­—å…¸ã€NSNumber å’Œ Block å®ç°äº†è¯¥åè®®çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ä¸¤ä¸ªæ–¹æ³•æ‰€å®ç°çš„é€»è¾‘å¤§åŒå°å¼‚ï¼›")]),e._v(" "),n("li",[e._v("copy ä¿®é¥°å±æ€§çš„æœ¬è´¨æ˜¯è‡ªåŠ¨è°ƒç”¨æ–°å€¼çš„ copy æ–¹æ³•ä»¥è·å–ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼Œå±æ€§æ—  mutableCopy ä¿®é¥°ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦ï¼›")]),e._v(" "),n("li",[e._v("copy ä¿®é¥° Block å±æ€§çš„æœ¬è´¨ä»ç„¶æ˜¯è°ƒç”¨ copy æ–¹æ³•ï¼Œåªæ˜¯å…¶å†…éƒ¨å®ç°æ˜¯å°†å­˜æ”¾åœ¨æ ˆä¸Šçš„ block è½¬ç§»åˆ°å †ä¸Šï¼Œå¦åˆ™æ ˆä¸­çš„ Block è¢«é”€æ¯åä¼šè®¿é—®æŒ‡å‘è¯¥ Block çš„æŒ‡é’ˆä¼šäº§ç”Ÿåå†…å­˜è®¿é—®é—®é¢˜ï¼›")])])])}),[],!1,null,null,null);o.default=a.exports}}]);